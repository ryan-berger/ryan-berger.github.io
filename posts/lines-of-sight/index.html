<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Finding the Longest Line of Sight | Ryan Berger's Page</title><meta name=keywords content><meta name=description content="One fateful day I was browsing a tech forum, lobste.rs, and stumbled upon a message that would captivate me for 6 months.
My good friend Tom Buckley-Houston, posted in a &ldquo;what are you working on this week&rdquo; thread
that he was working on algorithmically finding the longest line of sight in the world. In other words, how far from a (likely) very tall
point can you see another (likely) tall point?
&ldquo;Well Ryan,&rdquo; you may be saying, &ldquo;isn&rsquo;t this a solved problem? It&rsquo;s somewhere between Russia and China&rdquo;
and I would say: &ldquo;have you explored the entire earth yet?&rdquo; It took a lot of very good sleuths to find the theoretical
longest line of sight, but we haven&rsquo;t exhaustively proven there can&rsquo;t be any longer, have we?"><meta name=author content="Ryan Berger"><link rel=canonical href=https://ryan.berge.rs/posts/lines-of-sight/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://ryan.berge.rs/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://ryan.berge.rs/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://ryan.berge.rs/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://ryan.berge.rs/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://ryan.berge.rs/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ryan.berge.rs/posts/lines-of-sight/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload=renderMathInElement(document.body)></script><meta property="og:url" content="https://ryan.berge.rs/posts/lines-of-sight/"><meta property="og:site_name" content="Ryan Berger's Page"><meta property="og:title" content="Finding the Longest Line of Sight"><meta property="og:description" content="One fateful day I was browsing a tech forum, lobste.rs, and stumbled upon a message that would captivate me for 6 months.
My good friend Tom Buckley-Houston, posted in a “what are you working on this week” thread that he was working on algorithmically finding the longest line of sight in the world. In other words, how far from a (likely) very tall point can you see another (likely) tall point?
“Well Ryan,” you may be saying, “isn’t this a solved problem? It’s somewhere between Russia and China” and I would say: “have you explored the entire earth yet?” It took a lot of very good sleuths to find the theoretical longest line of sight, but we haven’t exhaustively proven there can’t be any longer, have we?"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-02-09T19:10:00-07:00"><meta property="article:modified_time" content="2026-02-09T19:10:00-07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Finding the Longest Line of Sight"><meta name=twitter:description content="One fateful day I was browsing a tech forum, lobste.rs, and stumbled upon a message that would captivate me for 6 months.
My good friend Tom Buckley-Houston, posted in a &ldquo;what are you working on this week&rdquo; thread
that he was working on algorithmically finding the longest line of sight in the world. In other words, how far from a (likely) very tall
point can you see another (likely) tall point?
&ldquo;Well Ryan,&rdquo; you may be saying, &ldquo;isn&rsquo;t this a solved problem? It&rsquo;s somewhere between Russia and China&rdquo;
and I would say: &ldquo;have you explored the entire earth yet?&rdquo; It took a lot of very good sleuths to find the theoretical
longest line of sight, but we haven&rsquo;t exhaustively proven there can&rsquo;t be any longer, have we?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ryan.berge.rs/posts/"},{"@type":"ListItem","position":2,"name":"Finding the Longest Line of Sight","item":"https://ryan.berge.rs/posts/lines-of-sight/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Finding the Longest Line of Sight","name":"Finding the Longest Line of Sight","description":"One fateful day I was browsing a tech forum, lobste.rs, and stumbled upon a message that would captivate me for 6 months.\nMy good friend Tom Buckley-Houston, posted in a \u0026ldquo;what are you working on this week\u0026rdquo; thread that he was working on algorithmically finding the longest line of sight in the world. In other words, how far from a (likely) very tall point can you see another (likely) tall point?\n\u0026ldquo;Well Ryan,\u0026rdquo; you may be saying, \u0026ldquo;isn\u0026rsquo;t this a solved problem? It\u0026rsquo;s somewhere between Russia and China\u0026rdquo; and I would say: \u0026ldquo;have you explored the entire earth yet?\u0026rdquo; It took a lot of very good sleuths to find the theoretical longest line of sight, but we haven\u0026rsquo;t exhaustively proven there can\u0026rsquo;t be any longer, have we?\n","keywords":[],"articleBody":"One fateful day I was browsing a tech forum, lobste.rs, and stumbled upon a message that would captivate me for 6 months.\nMy good friend Tom Buckley-Houston, posted in a “what are you working on this week” thread that he was working on algorithmically finding the longest line of sight in the world. In other words, how far from a (likely) very tall point can you see another (likely) tall point?\n“Well Ryan,” you may be saying, “isn’t this a solved problem? It’s somewhere between Russia and China” and I would say: “have you explored the entire earth yet?” It took a lot of very good sleuths to find the theoretical longest line of sight, but we haven’t exhaustively proven there can’t be any longer, have we?\nWhat if, like a mathematician, we could prove by cases that we have checked every line of sight? What if we wanted to know the longest line of sight in Seattle? What about in Utah? Wales? From Everest? What about if the air temperature is low? The earth is flat? All these questions are interesting, but adjusting each variable may require a full recalculation for the entire world. A single one of these would take millions of years of a mathematician’s time. How would they even gather all the data in the first place? Roam the earth?\nThankfully, silicon manufacturers have created little “proof by case” mathematicians that are ubiquitous and extremely inexpensive. And thanks to the NASA, we have a detailed LiDAR map which gives us an average elevation for every 100mx100m section of land for the entire planet. The perfect conditions for someone to take this on, and saving me from spending billions on wandering mathematicians!\nViewsheds How do we prove this? We’ve decided to use a viewshed algorithm.\nYou may feel duped that I’m now talking about viewsheds and not long lines of sight, but don’t worry we’ll get there.\nA viewshed is a sort of top-down visibility panorama for a particular point on a map. It works by processing each line of sight in all 360 degrees and “coloring in” all the visible points, after which all the visible area from the lookout will be colored in. However, we need to do this for all possible look-out locations on the map which is called a “total viewshed” or TVS for short. In our case, we’ll need a TVS of the entire world, but all current methods are woefully unequipped for this.\nSingular viewshed analysis tools are not built for calculating a TVS, rather, they exist to calculate the viewshed for one or two prominent points (i.e. a new building), not billions!\nTo get a feel for what a viewshed looks like, here’s a viewshed from Tom’s home country of Wales that we are now both very acquainted with:\nAll the gray portions of the map are what are visible from a look-out point from a river bed in Cardiff.\nA TVS of the same area on the other hand, looks like this: Very different! The more surface area that is visible, the whiter the heatmap, meaning you can see more (and potentially further).\nA Fork In The Road Primed with this introductory knowledge, you now have two choices. The following blog post is my attempt at a non-technical blog post about the project, but you can also choose the technical version where I get into the nitty-gritty about all the interesting hardware and software details. Use your free will accordingly:\nKeep Going\nA Treacherous Path\nA Starting Point Tom implemented a TVS algorithm from some Spanish researchers, and in July of 2025 picked it back up with some extra performance improvements and modifications. The initial test runs with this algorithm to find the longest line of sight on Everest took roughly 12 hours to run for a measly maximum line of sight of 600km. Tom theorized Everest’s could be much bigger at ~800km making this approach even less feasible. Because you are working with a square, 600km -\u003e 800km is actually 1.7x more data, not just 1.3x. The computation time it takes is cubed in terms of the line of sight, meaning 600km -\u003e 800km is actually 2.3x slower to run, taking just over a day. Ouch!\nEven taking a quarter of that amount of time and doing this for the entire world is algorithmically infeasible, unless you have many millions of dollars and years of compute to spare.\nComputers Are Faster Than You Think After hearing Tom mention the 12-hour number, something smelled quite fishy to me. Tom swore up and down that it was the size of the data, which he is correct; it is a huge amount.\nHow massive? For Everest, it is a 600km by 600km tile, the satellite data is recorded at a 100m resolution, which means that there are 6000 by 6000 points for a given tile. For each of those 36,000,000 points, you need to check in 360 different directions, out to the maximum line of sight of 6000 points. So, for those not keeping track, we have:\n$$ 6000 * 6000 * 6000 * 360 \\newline= 77,760,000,000,000 $$\nPoints to process. Yes, 77.7 TRILLION. If a wandering mathematician walked to every point on Everest’s map every second for their whole life I hope they are a vampire because it would take ~2.5 million years for them to complete their journey. YIKES.\nHowever, after calculating the above number, I was even more suspicious. Even though it may not seem like it, because it takes 10 hours and a gazillion-and-a-half gigs of RAM to open a new Chrome tab, computers are much faster than they used to be. Consumer GPUs now have performance measured in the teraflops, and consumer multicore CPUs in the hundreds of gigaflops. Calculating lines of sight at those speeds should reduce the problem down to minutes.\nGetting that level of compute used to be (a) impossible, or (b) nation-state level. Nowadays, your Apple M-series laptop can do this speed of computation without internal fans.\nSo, as the naive but hopeful software engineer I am, I set out to optimize an algorithm for the longest line of sight.\nMy Algorithm Line of Sight Visibility The longest line of sight is defined in terms of visibility as it is the furthest visible - and unobstructed - point from the observer.\nHow can we determine whether our view is obstructed between two points? Well, we can project ourselves onto the map like the little Google Maps Street View Guy™ and keep track of the furthest, tallest thing we’ve seen. If we compare where we are looking with the furthest, highest elevation we’ve seen, we can determine if there is something taller obstructing our view.\nTake for example this cross-section of the Street View Guy™’s line of sight when looking straight forward:\nIt sees a valley, which then turns into a hill, of which there is a second smaller hill behind.\nImagine we send a surveyor out along the line of sight with their laser level to determine whether they can see the observer: As the surveyor walks down the valley they are able to note that they can still see the observer since the valley has a lower elevation. Then, as our surveyor climbs up the hill to the top, they’ll be able to see the observer on the entire front face of the hill.\nSuddenly at the crest, they reach the peak for which there is not one closer or higher, and as they survey from the back side of the hill the observer will no longer be visible. The tallest, furthest point (the first peak) is obstructing it.\nSharing is Caring The first thing that I noticed about the algorithm Tom implemented is that although the authors mention that it “shares” a lot, it doesn’t actually share that much data. What sort of data am I looking to share? Well, elevation data.\nTom’s implementation of the researcher’s algorithm caused me to re-deploy surveyors each time I do the line of sight calculation. Each would do a single check to determine whether it is higher than the current highest seen elevation.\nBut if I already know I need to find the longest line of sight within the valley - or from any other point on the terrain - why not send out a bunch of surveyors all at once, and make sure that they also record the longest line for themselves:\nHere the surveyors are not only sharing whether the first observer is higher than previous highest, but they act as observers themselves. And in fact, the first observer can head up to the front lines. Then they’ll make themselves useful in determining whether they are higher than the current highest for the second observer’s line of sight.\nBecause sending out a new surveyor each time is memory intensive for a computer, we are wasting tons of memory accesses. Not sharing memory efficiently incurs a penalty on the order of magnitude of taking a flight with multiple layovers, but flying back to the original airport at each stop before making the next connecting flight.\nGet Rotated, idiot So, how do we share data? The answer is simple: we need to process points in order of the line of sight. Our observer has a range of view left and right of only one degree, meaning we need to process a line of sight for each degree of 360 degrees in the panorama.\nWe always start from the left and go to the right, but only knowing the angle causes lots of re-deploying of surveyors. Processing all points at a 45-degree angle without ordering them properly looks like this:\nYuck! Look at how little each point overlaps! Our surveyors are getting redeployed at that angle for each blue point.\nIt may be counterintuitive, but this whole ordering mess can all be solved by rotating the map! Here’s the map rotated 45 degrees, starting from the same corner and processing from left to right:\nNotice that the arrows overlap quite a bit! It means we never have to re-deploy surveyors out to measure the visibility.\nI Can Be Your Angle… Or Yuor Devil Although I want a huge amounts of sharing when it comes to the data I’m using for calculation, the last thing I want is for each surveyor to get caught up by the past one’s line of sight calculations.\nKeeping track of the change in elevations is kind of annoying. A surveyor depends on the one before it! A carried dependency, yuck. Wouldn’t it be nice if you could do some basic computation given the observer and the target point and be able to free yourself of the shackles of the carried dependency?!? High school math teachers have this one neat trick they don’t want you to know: angles.\nThe angle between the observer and a particular point is an Opposite/Adjacent (TOA of SOHCAHTOA fame) relationship on a right triangle: Meaning the angle between the observer and a point is:\n$$ tan(angle) = (elevation - observerHeight) / distance \\newline angle = tan^{-1}((elevation - observerHeight) / distance) $$\nNotice, that the angle is a relationship between both how far a point is, and how tall a point is.\nThis makes it perfect for our viewshed calculation. We don’t need to keep track of the highest, furthest point. Rather, we need to keep track of the highest angle we’ve seen. A point along our line of sight will only be visible if its angle is higher than the highest angle we’ve seen. This lets us not have to worry about how far away or how tall it is, just the angle.\nAngle Visibility Now that we can very quickly - and in parallel - calculate the angles in our line of sight, we need to determine if a particular point is visible. To do this in parallel we calculate the “exclusive prefix maximum” which is a list where each point gets an item calculated from the highest of all previous angles. This way, each surveyor can determine whether itself is visible to the observer.\nMore concretely, here’s our angles between our surveyors (excuse my straight lines):\nCalculating the prefix maximum for the angles would leave us with:\nNotice the last two surveyor’s angles both have a prefix maximum of 42°. The 42° angle gets copied over for the last surveyor because 30° isn’t higher than 42°, and the prefix maximum is the highest of all previous angles.\nOnly surveyors whose angle is greater than their prefix maximum are visible, and now they can independently determine if they are visible to the observer!\nRefraction and Curvature Despite me and my coauthor’s many protestations, the earth is unfortunately not flat. It is an oblate spheroid, and the sky is in fact blue. No, not rhetorically, the sky is blue due to light refraction within our atmosphere which, turns out, affects what is visible to us. Light quite literally curves through air to let photons hit your eyeballs.\nThis is why for example, you can see a mirage off in the distance. What creates these conditions? Generally a temperature difference between two layers of air, which happens to generally correlate to altitude.\nWhen conditions are right, photons are able to overcome earth’s curvature and let you see further.\nHow does our tool account for this? There is a refraction equation in the GIS literature that will let us adjust the elevations of the points along our line of sight.\nThis plays along perfectly with our angle calculation.\nPutting It Together To pull this all together to get something capable of finding the longest line of sight for the world we:\nCalculate the worst case line of sight for each region of the earth, chunking it up into smaller pieces. For each chunk, we calculate every line of sight for every point on the map, rotating the map 360 degrees to get a full panorama. Keep track of the furthest visible point for all points on the map, for all degrees, and for every chunk. Then we’ll combine them to get the world’s longest line of sight. And how fast is it? Screaming fast.\nRunning it on my old i9900k CPU with 128GB of DDR4 RAM results in a drastic speedup. It went from Everest taking 12 hours on a GPU with Tom’s original implementation, to 57 minutes on my CPU - something much less powerful. WOW.\nWhen I run it on a top of the line machines, I can cut that down to 4 and a half minutes flat. A 160x speed up. Bonkers.\nRunning it for all 2500 tiles took about 18 hours with 5 very large machines that Tom and I rented.\nWhere is it? Would you like to know what the longest line of sight is? Well, we have the longest line of sight leaderboard you can check out at https://alltheviews.world! We’ve worked quite hard to document our journey and build a very cool tool to show off the beautiful earth and all its long lines of sight, enjoy!\nAcknowledgements I’d like to acknowledge first and foremost, Tom Buckley-Houston for his willingness to collaborate and steadfastness in keeping the project moving and keeping bugs away even during the hardest parts of the project. Please go check out his blogpost here\nI’d also like to acknowledge my amazing family and friends who have listened to my crazed ramblings about rotations, lines of sight, and each new optimization or timing I discovered throughout the process. Thanks lots!\n","wordCount":"2592","inLanguage":"en","datePublished":"2026-02-09T19:10:00-07:00","dateModified":"2026-02-09T19:10:00-07:00","author":[{"@type":"Person","name":"Ryan Berger"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://ryan.berge.rs/posts/lines-of-sight/"},"publisher":{"@type":"Organization","name":"Ryan Berger's Page","logo":{"@type":"ImageObject","url":"https://ryan.berge.rs/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://ryan.berge.rs/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://ryan.berge.rs/blog/ title=Blog><span>Blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Finding the Longest Line of Sight</h1><div class=post-meta><span title='2026-02-09 19:10:00 -0700 -0700'>February 9, 2026</span>&nbsp;·&nbsp;13 min&nbsp;·&nbsp;Ryan Berger</div></header><div class=post-content><p>One fateful day I was browsing a tech forum, <a href=https://lobste.rs>lobste.rs</a>, and stumbled upon a message that would captivate me for 6 months.</p><p>My good friend <a href=https://tombh.co.uk>Tom Buckley-Houston</a>, posted in a <a href=https://lobste.rs/s/2ftfd1/what_are_you_doing_this_week#c_uiub1p>&ldquo;what are you working on this week&rdquo; thread</a>
that he was working on algorithmically finding the longest line of sight in the world. In other words, how far from a (likely) very tall
point can you see another (likely) tall point?</p><p>&ldquo;Well Ryan,&rdquo; you may be saying, &ldquo;isn&rsquo;t this a solved problem? <a href=https://www.summitpost.org/phpBB3/longest-lines-of-sight-photographed-t44409-150.html>It&rsquo;s somewhere between Russia and China</a>&rdquo;
and I would say: &ldquo;have you explored the entire earth yet?&rdquo; It took a lot of very good sleuths to find the theoretical
longest line of sight, but we haven&rsquo;t exhaustively proven there can&rsquo;t be any longer, have we?</p><p>What if, like a mathematician, we could prove by cases that we have checked every line of sight?
What if we wanted to know the longest line of sight in Seattle? What about in Utah? Wales? From Everest?
What about if the air temperature is low? The earth is flat? All these questions are interesting, but adjusting each
variable may require a full recalculation for the entire world. A single one of these would take millions of years of a
mathematician&rsquo;s time. How would they even gather all the data in the first place? Roam the earth?</p><p>Thankfully, silicon manufacturers have created little &ldquo;proof by case&rdquo; mathematicians that are ubiquitous and
extremely inexpensive. And thanks to the NASA, we have a detailed LiDAR map which gives us an average elevation
for every 100mx100m section of land for the entire planet. The perfect conditions for someone to take this on, and saving
me from spending billions on wandering mathematicians!</p><h2 id=viewsheds>Viewsheds<a hidden class=anchor aria-hidden=true href=#viewsheds>#</a></h2><p>How do we prove this? We&rsquo;ve decided to use a viewshed algorithm.</p><p>You may feel duped that I&rsquo;m now talking about viewsheds and not long lines of sight, but don&rsquo;t worry we&rsquo;ll get there.</p><p>A <a href=https://en.wikipedia.org/wiki/Viewshed>viewshed</a> is a sort of top-down visibility panorama for a particular point on
a map. It works by processing each line of sight in all 360 degrees and &ldquo;coloring in&rdquo; all the visible points,
after which all the visible area from the lookout will be colored in. However, we need to do this for <em>all</em> possible look-out
locations on the map which is called a &ldquo;total viewshed&rdquo; or TVS for short. In our case, we&rsquo;ll need a TVS of
the entire world, but all current methods are woefully unequipped for this.</p><p>Singular viewshed analysis tools are not built for calculating a TVS, rather, they exist to calculate the viewshed for
one or two prominent points (i.e. a new building), not billions!</p><p>To get a feel for what a viewshed looks like, here&rsquo;s a viewshed from Tom&rsquo;s home country of Wales that we
are now both very acquainted with:</p><figure class=align-center><img loading=lazy src=/lines/cardiff_viewshed.png#center></figure><p>All the gray portions of the map are what are visible from a look-out point from a river bed in Cardiff.</p><p>A TVS of the same area on the other hand, looks like this:<figure class=align-center><img loading=lazy src=/lines/total_surfaces.png#center></figure></p><p>Very different! The more surface area that is visible, the whiter the heatmap, meaning you can
see more (and potentially further).</p><h3 id=a-fork-in-the-road>A Fork In The Road<a hidden class=anchor aria-hidden=true href=#a-fork-in-the-road>#</a></h3><p>Primed with this introductory knowledge, you now have two choices. The following blog post is my attempt at a non-technical
blog post about the project, but you can also choose the technical version where I get into the nitty-gritty about all
the interesting hardware and software details. Use your free will accordingly:</p><p><a href=#a-starting-point>Keep Going</a></p><p><a href=/posts/total-viewshed-algorithm>A Treacherous Path</a></p><h3 id=a-starting-point>A Starting Point<a hidden class=anchor aria-hidden=true href=#a-starting-point>#</a></h3><p>Tom implemented a TVS algorithm from some <a href=https://ieeexplore.ieee.org/document/6837455>Spanish researchers</a>, and in
July of 2025 picked it back up with some extra performance improvements and modifications. The initial test runs with
this algorithm to find the longest line of sight on Everest took roughly 12 hours to run for a measly maximum line of
sight of 600km. Tom theorized Everest&rsquo;s could be much bigger at ~800km making this approach even less feasible. Because
you are working with a square, 600km -> 800km is actually 1.7x more data, not just 1.3x. The computation time it takes is
cubed in terms of the line of sight, meaning 600km -> 800km is actually 2.3x slower to run, taking just over a day. Ouch!</p><p>Even taking a quarter of that amount of time and doing this for the entire world is algorithmically infeasible,
unless you have many millions of dollars and years of compute to spare.</p><h3 id=computers-are-faster-than-you-think>Computers Are Faster Than You Think<a hidden class=anchor aria-hidden=true href=#computers-are-faster-than-you-think>#</a></h3><p>After hearing Tom mention the 12-hour number, something smelled quite fishy to me. Tom swore up and down that it was
the size of the data, which he is correct; it is a huge amount.</p><p>How massive? For Everest, it is a 600km by 600km tile, the satellite data is recorded at a 100m resolution, which means that
there are 6000 by 6000 points for a given tile. For each of those 36,000,000 points, you need to check in
360 different directions, out to the maximum line of sight of 6000 points. So, for those not keeping track, we have:</p><p>$$
6000 * 6000 * 6000 * 360 \newline= 77,760,000,000,000
$$</p><p>Points to process. Yes, 77.7 TRILLION. If a wandering mathematician walked to every point on Everest&rsquo;s map every
second for their whole life I hope they are a vampire because it would take ~2.5 million years for them to complete
their journey. YIKES.</p><p>However, after calculating the above number, I was even more suspicious. Even though it may not seem like it, because
it takes 10 hours and a gazillion-and-a-half gigs of RAM to open a new Chrome tab, computers are much faster than they used to be.
Consumer GPUs now have performance measured in the teraflops, and consumer multicore CPUs in the hundreds of gigaflops.
Calculating lines of sight at those speeds should reduce the problem down to minutes.</p><p>Getting that level of compute used to be (a) impossible, or (b) nation-state level. Nowadays, your Apple M-series laptop
can do this speed of computation without internal fans.</p><p>So, as the naive but hopeful software engineer I am, I set out to optimize an algorithm for the longest line of sight.</p><h2 id=my-algorithm>My Algorithm<a hidden class=anchor aria-hidden=true href=#my-algorithm>#</a></h2><h3 id=line-of-sight-visibility>Line of Sight Visibility<a hidden class=anchor aria-hidden=true href=#line-of-sight-visibility>#</a></h3><p>The longest line of sight is defined in terms of visibility as it is the furthest visible - and unobstructed - point from the observer.</p><p>How can we determine whether our view is obstructed between two points? Well, we can project ourselves onto the map like the
little Google Maps Street View Guy™ and keep track of the furthest, tallest thing we&rsquo;ve seen. If we compare
where we are looking with the furthest, highest elevation we&rsquo;ve seen, we can determine if there is something taller obstructing our view.</p><p>Take for example this cross-section of the Street View Guy™&rsquo;s line of sight when looking straight forward:</p><figure class=align-center><img loading=lazy src=/lines/visibility.png#center></figure><p>It sees a valley, which then turns into a hill, of which there is a second smaller hill behind.</p><p>Imagine we send a surveyor out along the line of sight with their <a href=https://en.wikipedia.org/wiki/Laser_level>laser level</a> to determine whether they can
see the observer:<figure class=align-center><img loading=lazy src=/lines/visibility_surveyor.png#center></figure></p><p>As the surveyor walks down the valley they are able to note that they can still see the
observer since the valley has a lower elevation. Then, as our surveyor climbs up the hill to the top,
they&rsquo;ll be able to see the observer on the entire front face of the hill.</p><p>Suddenly at the crest, they reach the peak for which there is not one closer or higher, and as they survey from the back side of the
hill the observer will no longer be visible. The tallest, furthest point (the first peak) is obstructing it.</p><h3 id=sharing-is-caring>Sharing is Caring<a hidden class=anchor aria-hidden=true href=#sharing-is-caring>#</a></h3><p>The first thing that I noticed about the algorithm Tom implemented is that although the authors mention that it
&ldquo;shares&rdquo; a lot, it doesn&rsquo;t actually share that much data. What sort of data am I looking to share? Well, elevation data.</p><p>Tom&rsquo;s implementation of the researcher&rsquo;s algorithm caused me to re-deploy surveyors each time I do the line of sight calculation.
Each would do a single check to determine whether it is higher than the current highest seen elevation.</p><figure class=align-center><img loading=lazy src=/lines/redeploy.png#center></figure><p>But if I already know I need to find the longest line of sight within the valley - or from any other point on the terrain -
why not send out a bunch of surveyors all at once, and make sure that they <em>also</em> record the longest line for themselves:</p><figure class=align-center><img loading=lazy src=/lines/observer_surveyor.png#center></figure><p>Here the surveyors are not only sharing whether the first observer is higher than previous highest, but they act as observers themselves.
And in fact, the first observer can head up to the front lines. Then they&rsquo;ll make themselves useful in determining whether
they are higher than the current highest for the second observer&rsquo;s line of sight.</p><figure class=align-center><img loading=lazy src=/lines/observer_surveyor_two.png#center></figure><p>Because sending out a new surveyor each time is memory intensive for a computer, we are wasting tons of memory accesses.
Not sharing memory efficiently incurs a penalty on the order of magnitude of taking a flight with multiple layovers,
but flying back to the original airport at each stop before making the next connecting flight.</p><h3 id=get-rotated-idiot><a href="https://www.youtube.com/watch?v=BUi4eHBGAII">Get Rotated, idiot</a><a hidden class=anchor aria-hidden=true href=#get-rotated-idiot>#</a></h3><p>So, how do we share data? The answer is simple: we need to process points in order of the line of sight.
Our observer has a range of view left and right of only one degree, meaning we need to process
a line of sight for each degree of 360 degrees in the panorama.</p><p>We always start from the left and go to the right, but only knowing the angle causes lots of re-deploying
of surveyors. Processing all points at a 45-degree angle without ordering them properly looks like this:</p><figure class=align-center><img loading=lazy src=/lines/unrotated_order.png#center></figure><p>Yuck! Look at how little each point overlaps! Our surveyors are getting redeployed at that angle for each
blue point.</p><p>It may be counterintuitive, but this whole ordering mess can all be solved by <em>rotating</em> the map!
Here&rsquo;s the map rotated 45 degrees, starting from the same corner and processing from left to right:</p><figure class=align-center><img loading=lazy src=/lines/rotated_order.png#center></figure><p>Notice that the arrows overlap quite a bit! It means we never have to re-deploy surveyors out to measure the visibility.</p><h3 id=i-can-be-your-angle-or-yuor-devil>I Can Be Your Angle&mldr; Or Yuor Devil<a hidden class=anchor aria-hidden=true href=#i-can-be-your-angle-or-yuor-devil>#</a></h3><p>Although I want a huge amounts of sharing when it comes to the data I&rsquo;m using for calculation, the <em>last</em> thing I want
is for each surveyor to get caught up by the past one&rsquo;s line of sight calculations.</p><p>Keeping track of the change in elevations is kind of annoying. A surveyor depends on the one before it!
A carried dependency, yuck. Wouldn&rsquo;t it be nice if you could do some basic computation given the observer and
the target point and be able to free yourself of the shackles of the carried dependency?!?
High school math teachers have this one neat trick they don&rsquo;t want you to know: angles.</p><p>The angle between the observer and a particular point is an Opposite/Adjacent (TOA of SOHCAHTOA fame)
relationship on a right triangle:<figure class=align-center><img loading=lazy src=/lines/sohcahtoah.png#center></figure></p><p>Meaning the angle between the observer and a point is:</p><p>$$
tan(angle) = (elevation - observerHeight) / distance \newline
angle = tan^{-1}((elevation - observerHeight) / distance)
$$</p><p>Notice, that the angle is a relationship between both <em>how far</em> a point is, and <em>how tall</em> a point is.</p><p>This makes it perfect for our viewshed calculation. We don&rsquo;t need to keep track of the highest, furthest point.
Rather, we need to keep track of the highest angle we&rsquo;ve seen. A point along our line of sight will only be visible
if its angle is higher than the highest angle we&rsquo;ve seen. This lets us not have to worry about how far away or
how tall it is, just the angle.</p><h3 id=angle-visibility>Angle Visibility<a hidden class=anchor aria-hidden=true href=#angle-visibility>#</a></h3><p>Now that we can very quickly - and in parallel - calculate the angles in our line of sight, we need to determine if a particular
point is visible. To do this in parallel we calculate the &ldquo;exclusive prefix maximum&rdquo; which is a list where each point gets
an item calculated from the highest of <em>all</em> previous angles. This way, each surveyor can determine whether itself is visible to the observer.</p><p>More concretely, here&rsquo;s our angles between our surveyors (excuse my straight lines):</p><figure class=align-center><img loading=lazy src=/lines/angles.png#center></figure><p>Calculating the prefix maximum for the angles would leave us with:</p><figure class=align-center><img loading=lazy src=/lines/angles_prefix_max.png#center></figure><p>Notice the last two surveyor&rsquo;s angles both have a prefix maximum of 42°. The 42° angle gets copied over for the
last surveyor because 30° isn&rsquo;t higher than 42°, and the prefix maximum is the highest of <em>all</em> previous angles.</p><p>Only surveyors whose angle is greater than their prefix maximum are visible, and now they can independently
determine if they are visible to the observer!</p><h3 id=refraction-and-curvature>Refraction and Curvature<a hidden class=anchor aria-hidden=true href=#refraction-and-curvature>#</a></h3><p>Despite me and my coauthor&rsquo;s many protestations, the earth is unfortunately not flat. It is an oblate spheroid, and the sky
is in fact blue. No, not rhetorically, the sky is blue due to light refraction within our atmosphere which, turns out,
affects what is visible to us. Light quite literally curves through air to let photons hit your eyeballs.</p><p>This is why for example, you can see a mirage off in the distance. What creates these conditions? Generally a temperature
difference between two layers of air, which happens to generally correlate to altitude.</p><p>When conditions are right, photons are able to overcome earth&rsquo;s curvature and let you see further.</p><p>How does our tool account for this? There is a refraction equation in the <a href=https://pro.arcgis.com/en/pro-app/3.4/tool-reference/3d-analyst/how-line-of-sight-works.htm>GIS literature</a>
that will let us adjust the elevations of the points along our line of sight.</p><figure class=align-center><img loading=lazy src=/lines/refraction.png#center></figure><p>This plays along perfectly with our angle calculation.</p><h3 id=putting-it-together>Putting It Together<a hidden class=anchor aria-hidden=true href=#putting-it-together>#</a></h3><p>To pull this all together to get something capable of finding the longest line of sight for the world we:</p><ul><li>Calculate the worst case line of sight for each region of the earth, <a href=https://tombh.co.uk/packing-world-lines-of-sight>chunking it up into smaller pieces.</a></li><li>For each chunk, we calculate every line of sight for every point on the map, rotating the map 360 degrees to get a full panorama.</li><li>Keep track of the furthest visible point for all points on the map, for all degrees, and for every chunk. Then we&rsquo;ll combine them to get the world&rsquo;s longest line of sight.</li></ul><p>And how fast is it? <em>Screaming fast</em>.</p><p>Running it on my old i9900k CPU with 128GB of DDR4 RAM results in a drastic speedup. It went from Everest taking
12 hours on a GPU with Tom&rsquo;s original implementation, to <em><strong>57 minutes</strong></em> on my CPU - something much less powerful. WOW.</p><p>When I run it on a top of the line machines, I can cut that down to <em><strong>4 and a half minutes flat</strong></em>. A 160x speed up.
Bonkers.</p><p>Running it for all 2500 tiles took about 18 hours with 5 very large machines that Tom and I rented.</p><h3 id=where-is-it>Where is it?<a hidden class=anchor aria-hidden=true href=#where-is-it>#</a></h3><p>Would you like to know what the longest line of sight is? Well, we have the longest line of sight leaderboard you can
check out at <a href=https://alltheviews.world>https://alltheviews.world</a>! We&rsquo;ve worked quite hard to document our journey and build a very cool
tool to show off the beautiful earth and all its long lines of sight, enjoy!</p><h2 id=acknowledgements>Acknowledgements<a hidden class=anchor aria-hidden=true href=#acknowledgements>#</a></h2><p>I&rsquo;d like to acknowledge first and foremost, Tom Buckley-Houston for his willingness to collaborate and
steadfastness in keeping the project moving and keeping bugs away even during the hardest parts of the project.
Please go check out his blogpost <a href=https://tombh.co.uk/longest-line-of-sight>here</a></p><p>I&rsquo;d also like to acknowledge my amazing family and friends who have listened to my crazed ramblings about rotations,
lines of sight, and each new optimization or timing I discovered throughout the process. Thanks lots!</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://ryan.berge.rs/>Ryan Berger's Page</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>